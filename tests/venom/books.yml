name: /books tests
vars:
    endpoint: 'http://localhost:3000/books/' #todo use it
    endpointBookUuid: '010242be-bfca-4bf0-96e6-174fd79f8cd8'

testcases:
- name: GET collection
  steps:
  - type: http
    method: GET
    url: 'http://localhost:3000/books'
    assertions:
    - result.statuscode ShouldEqual 200
    - result.bodyjson.__type__ ShouldEqual Array
    - result.bodyjson.__len__ ShouldBeGreaterThanOrEqualTo 2

- name: POST
  steps:
    - type: http
      method: POST
      url: 'http://localhost:3000/books'
      body: '{"title": "testTitle", "price": 1712}'
      assertions:
        - result.statuscode ShouldEqual 201
        - result.bodyjson.__type__ ShouldEqual Map
        - result.bodyjson.title ShouldEqual testTitle
        - result.bodyjson.price ShouldEqual 1712
    - type: http
      method: POST
      url: 'http://localhost:3000/books'
      body: '{"title": "testTitle"}'
      assertions:
        - result.statuscode ShouldEqual 400
    - type: http
      method: POST
      url: 'http://localhost:3000/books'
      body: '{"price": 5}'
      assertions:
        - result.statuscode ShouldEqual 400
    - type: http
      method: POST
      url: 'http://localhost:3000/books'
      body: '{"price": "badPrice"}'
      assertions:
        - result.statuscode ShouldEqual 400

- name: GET
  steps:
    - type: http
      method: GET
      url: http://localhost:3000/books/{{.POST.result.bodyjson.id}}
      assertions:
        - result.statuscode ShouldEqual 200
        - result.bodyjson.__type__ ShouldEqual Map
        - result.bodyjson.id ShouldEqual {{.POST.result.bodyjson.id}}
        - result.bodyjson.title ShouldEqual testTitle
        - result.bodyjson.price ShouldEqual 1712
    - type: http
      method: GET
      url: http://localhost:3000/books/{{.endpointBookUuid}}
      assertions:
        - result.statuscode ShouldEqual 404

- name: PUT
  steps:
    - type: http
      method: PUT
      url: http://localhost:3000/books/{{.POST.result.bodyjson.id}}
      body: '{"title": "testPutTitle", "price": 100}'
      assertions:
        - result.statuscode ShouldEqual 200
        - result.bodyjson.__type__ ShouldEqual Map
        - result.bodyjson.title ShouldEqual testPutTitle
        - result.bodyjson.price ShouldEqual 100

- name: DELETE
  steps:
    - type: http
      method: DELETE
      url:  http://localhost:3000/books/{{.POST.result.bodyjson.id}}
      assertions:
        - result.statuscode ShouldEqual 204
    - type: http
      method: DELETE
      url:  http://localhost:3000/books/{{.endpointBookUuid}}
      assertions:
        - result.statuscode ShouldEqual 404